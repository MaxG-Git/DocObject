var Doc;(()=>{"use strict";var e={391:function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&r(t,e,i);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.obj=t.DocObject=t.fixInput=void 0;const o=i(605),a=s(i(382));t.fixInput=function(e,t){let i=(0,o.getCursorPos)(e()[0]);t(),(0,o.setCursorPos)(e()[0],i)};class c extends HTMLElement{constructor(){super()}}window.customElements.define("d-bind",c);class d{constructor(e,t){const{elements:i,values:r,render:n,binds:s,bindAttr:o,bindInAttr:c,isJQuery:u}=d.defaultParams(t);let l=d.toNodeArray(e)[0];l instanceof HTMLElement?this.root=l:(0,a.default)(a.ROOT_ERROR,!0),u&&window.jQuery?(this._isJQuery=!0,this._querySelect=(...e)=>$(this.root).find(...e)):(u&&(0,a.default)(a.JQUERY_NOT_DETECTED,!1),this._isJQuery=!1,this._querySelect=(...e)=>this.root.querySelectorAll(...e)),this.root._DocObject=this,this.render=n,this.binds=s,this.bindAttr=o,this.bindInAttr=c,this.query=new Proxy({},{get:(e,t)=>{if("string"==typeof t)return e[t]?e[t]:e=>this._querySelect(/.*(\.|\#|\[|\]).*/gm.exec(t)?t:"#"+t)},set:(e,t,i,r)=>("string"==typeof i&&(i=()=>this._querySelect(i)),"string"==typeof t&&(e[t]=e=>i),!0)}),this.elements=new Proxy(this.query,{get:(e,t)=>e[t]()}),i&&Object.entries(i).forEach((e=>{this.query[e[0]]=e[1]})),this._values=new Proxy(r&&"object"==typeof r?r:{},{set:(e,t,i,r)=>(this.runRender({[t]:i}),e[t]=i,!0)}),this.onLoad=()=>{this.runRender({[!0]:!0})},this._isJQuery?$(this.onLoad):window.onload=this.onLoad}static toNodeArray(e){return"string"==typeof e?[...d.parser.parseFromString(e,"text/html").body.childNodes]:NodeList.prototype.isPrototypeOf(e)||window.jQuery&&e instanceof jQuery?[...e]:Array.isArray(e)?e.filter((e=>"string"==typeof e||e instanceof Node)).map((e=>"string"==typeof e?d.toNodeArray(e)[0]:e)):e instanceof Node||e instanceof Document?[e]:void 0}static defaultParams({render:e=[],binds:t={},elements:i={},values:r={},bindAttr:n="d-bind",bindInAttr:s="d-bind-in",isJQuery:o=!1}={}){return{elements:i,values:r,render:e,binds:t,bindAttr:n,bindInAttr:s,isJQuery:o}}set values(e){throw Error("Tried to set DocObject.value. Try creating a inner object instead.")}get values(){return this._values}isBindIn(e){return e.getAttribute(this.bindInAttr)&&!0}isBind(e){return("d-bind"===e.localName||e.getAttribute(this.bindAttr))&&!0}findOrRegisterBind(e){if(void 0===e._DocObjectConfig){let t=[...e.childNodes];t.toString=()=>e.innerHTML,e._DocObjectConfig={originalChildren:t,originalChildrenHTML:e.innerHTML,originalAttributes:[...e.attributes].reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.value})),{})}}return e._DocObjectConfig}generateBind(e,t,i){const r=e._DocObjectConfig,n=d.toNodeArray(i);if(this.isBind(e)){const e=n.find((e=>e instanceof HTMLElement));return e._DocObjectConfig=r,e.setAttribute("d-bind"===e.localName?"to":this.bindAttr,t),Object.entries(r.originalAttributes).filter((e=>!["d-bind-in","to"].includes(e[0]))).forEach((t=>e.setAttribute(t[0],t[1]))),e}return n}runRender(e={}){this.render.filter((t=>t.dep&&Array.isArray(t.dep)&&t.dep.some((t=>t in e))||void 0===t.dep)).forEach((t=>{t.clean&&t.clean(Object.assign(Object.assign({},this.values),e),this.values),t.action(Object.assign(Object.assign({},this.values),e),this.values)})),this.runBinds(this.root,e)}getBindAction(e){if(this.isBind(e)){if(e.getAttribute(this.bindAttr))return[e.getAttribute(this.bindAttr),t=>e.parentNode.replaceChild(t,e)];if("d-bind"===e.localName)return[e.getAttribute("to"),t=>e.parentNode.replaceChild(t,e)]}else if(this.isBindIn(e))return[e.getAttribute(this.bindInAttr),t=>{e.innerHTML="";for(let i of t)e.appendChild(i)}]}runBinds(e,t={}){return(Array.isArray(e)?e:[e]).filter((e=>e&&e instanceof HTMLElement)).forEach((e=>{[...e.querySelectorAll(`[${this.bindAttr}], [${this.bindInAttr}], d-bind[to]`)].forEach((e=>{const[i,r]=this.getBindAction(e);if(i in this.binds){const n=this.findOrRegisterBind(e);r(this.runBinds(this.generateBind(e,i,this.binds[i](Object.assign(Object.assign({},this.values),t),n.originalAttributes,n.originalChildren)),t))}}))})),e}}t.DocObject=d,d.parser=new DOMParser,window.jQuery&&jQuery.fn.extend({DocObject:function(e=null){return this[0]._DocObject&&!e||(this.each((function(){new d(this,e)})),new d(this,Object.assign({isJQuery:!0},e))),this[0]._DocObject}}),t.obj=function(e,t){return new d(e,t)}},382:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.JQUERY_NOT_DETECTED=t.ROOT_ERROR=void 0,t.ROOT_ERROR="ROOT_ERROR",t.JQUERY_NOT_DETECTED="JQUERY_NOT_DETECTED",t.default=function(e,t=!1){if(e in i){if(t)throw Error("DocObject: "+i[e].message);console.error(i[e].message)}};const i={ROOT_ERROR:{message:"Root Element Must be a valid Node, Or jQuery Element"},JQUERY_NOT_DETECTED:{message:"JQuery is not detected. Please load JQuery before DocObject"}}},605:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setCursorPos=t.getCursorPos=void 0,t.getCursorPos=function(e){return"backward"==e.selectionDirection?e.selectionStart:e.selectionEnd},t.setCursorPos=function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select()}}}},t={},i=function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,i),s.exports}(391);Doc=i})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RCxHQUt0QixNQUFxQyxZQUE5QkEsRUFBUW9ELG1CQUFtQ3BELEVBQVFxRCxlQUFpQnJELEVBQVFzRCxjQUkzRix3QkFBNkJ0RCxFQUE0QnJFLEdBRXJELEdBQUlxRSxFQUFRdUQsa0JBQ1p2RCxFQUFRd0QsUUFDUnhELEVBQVF1RCxrQkFBa0I1SCxFQUFLQSxRQUd4QixHQUFLcUUsRUFBZ0J5RCxnQkFBaUIsQ0FDM0MsSUFBSUMsRUFBUzFELEVBQWdCeUQsa0JBQzdCQyxFQUFNQyxVQUFTLEdBQ2ZELEVBQU1FLFFBQVEsWUFBYWpJLEdBQzNCK0gsRUFBTUcsVUFBVSxZQUFhbEksR0FDN0IrSCxFQUFNSSxhQzNCUkMsRUFBMkIsR0NFM0JDLEVEQ0osU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVKLEVBQXlCRyxHQUM1QyxRQUFxQjVELElBQWpCNkQsRUFDSCxPQUFPQSxFQUFhQyxRQUdyQixJQUFJQyxFQUFTTixFQUF5QkcsR0FBWSxDQUdqREUsUUFBUyxJQU9WLE9BSEFFLEVBQW9CSixHQUFVSyxLQUFLRixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTSCxHQUdwRUksRUFBT0QsUUNsQldILENBQW9CLEsiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Eb2MvLi9zcmMvdHMvZG9jb2JqZWN0LnRzIiwid2VicGFjazovL0RvYy8uL3NyYy90cy9lcnJvcnMudHMiLCJ3ZWJwYWNrOi8vRG9jLy4vc3JjL3RzL3V0aWxzLnRzIiwid2VicGFjazovL0RvYy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9Eb2Mvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQge3NldEN1cnNvclBvcywgZ2V0Q3Vyc29yUG9zfSBmcm9tIFwiLi91dGlsc1wiXHJcbmltcG9ydCB7IERvY09iamVjdERvbUJpbmQsIERvY09iamVjdEJpbmQgfSBmcm9tICcuL2RvY2JpbmQnXHJcbmltcG9ydCB7IERvY09iamVjdFJlbmRlciB9IGZyb20gJy4vZG9jcmVuZGVyJ1xyXG5pbXBvcnQgcnVuRXJyb3IsIHsgXHJcbiAgICBST09UX0VSUk9SLFxyXG4gICAgSlFVRVJZX05PVF9ERVRFQ1RFRFxyXG59IGZyb20gJy4vZXJyb3JzJztcclxuXHJcbi8qKioqKioqIEdMT0JBTFMgKioqKioqKi9cclxuZGVjbGFyZSBnbG9iYWwge1xyXG4gICAgaW50ZXJmYWNlIFdpbmRvdyB7XHJcbiAgICAgICAgalF1ZXJ5OmFueTtcclxuICAgICAgICBtc0NyeXB0bzphbnk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG4vKioqKioqKiBVVElMSVRZIE1FVEhPRFMgKioqKioqKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGZpeElucHV0KHNlbGVjdG9yLCBhY3Rpb24pe1xyXG4gICAgbGV0IHBvcyA9IGdldEN1cnNvclBvcyhzZWxlY3RvcigpWzBdKVxyXG4gICAgYWN0aW9uKClcclxuICAgIHNldEN1cnNvclBvcyhzZWxlY3RvcigpWzBdLCBwb3MpXHJcbn1cclxuXHJcblxyXG4vKioqKioqKiBET0MgT0JKRUNUICoqKioqKiovXHJcbmV4cG9ydCB0eXBlIERvY09iamVjdEhUTUxMaWtlID0gXHJcbnwgTm9kZVxyXG58IE5vZGVMaXN0XHJcbnwgSlF1ZXJ5IFxyXG58IHN0cmluZztcclxuXHJcblxyXG5pbnRlcmZhY2UgRG9jT2JqZWN0T3B0aW9ucyB7XHJcbiAgICByZW5kZXIgOiBEb2NPYmplY3RSZW5kZXI7XHJcbiAgICBiaW5kcyA6IERvY09iamVjdEJpbmQ7XHJcbiAgICBlbGVtZW50cyA6IHtba2V5OnN0cmluZ106IHN0cmluZ307XHJcbiAgICB2YWx1ZXMgOiBvYmplY3Q7XHJcbiAgICBiaW5kQXR0ciA6IHN0cmluZztcclxuICAgIGJpbmRJbkF0dHIgOiBzdHJpbmc7XHJcbiAgICBpc0pRdWVyeSA6IGJvb2xlYW47XHJcbn1cclxuXHJcbmludGVyZmFjZSBEb2NPYmplY3RFbGVtZW50IGV4dGVuZHMgSFRNTEVsZW1lbnQge1xyXG4gICAgX0RvY09iamVjdD8gOiBEb2NPYmplY3RcclxufVxyXG5cclxuaW50ZXJmYWNlIERvY09iamVjdEVsZW1lbnRzIHtcclxuICAgIFtrZXk6IHN0cmluZ10gOiBzdHJpbmcgfCAoKHNlbGVjdG9yIDogc3RyaW5nICkgPT4gTm9kZUxpc3R8SlF1ZXJ5KVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIERvY09iamVjdENvbmZpZyB7XHJcbiAgICBvcmlnaW5hbENoaWxkcmVuOiBBcnJheTxOb2RlPjtcclxuICAgIG9yaWdpbmFsQ2hpbGRyZW5IVE1MOiBzdHJpbmc7XHJcbiAgICBvcmlnaW5hbEF0dHJpYnV0ZXM6IHtba2V5OnN0cmluZ10gOiBzdHJpbmd9O1xyXG59XHJcblxyXG5jbGFzcyBCaW5kIGV4dGVuZHMgSFRNTEVsZW1lbnQge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoKVxyXG4gICAgfVxyXG59XHJcbndpbmRvdy5jdXN0b21FbGVtZW50cy5kZWZpbmUoJ2QtYmluZCcsIEJpbmQpXHJcbmV4cG9ydCBjbGFzcyBEb2NPYmplY3Qge1xyXG5cclxuICAgIHN0YXRpYyBwYXJzZXIgOiBET01QYXJzZXIgPSBuZXcgRE9NUGFyc2VyKClcclxuXHJcbiAgICBzdGF0aWMgdG9Ob2RlQXJyYXkoYW55IDogRG9jT2JqZWN0SFRNTExpa2UgfCBBcnJheTxzdHJpbmd8Tm9kZT4gKSA6IEFycmF5PE5vZGU+IHtcclxuICAgICAgICBpZih0eXBlb2YgYW55ID09PSAnc3RyaW5nJyl7XHJcbiAgICAgICAgICAgIHJldHVybiBbLi4uRG9jT2JqZWN0LnBhcnNlci5wYXJzZUZyb21TdHJpbmcoYW55LCAndGV4dC9odG1sJykuYm9keS5jaGlsZE5vZGVzXVxyXG4gICAgICAgIH1lbHNlIGlmKE5vZGVMaXN0LnByb3RvdHlwZS5pc1Byb3RvdHlwZU9mKGFueSkgfHwgKHdpbmRvdy5qUXVlcnkgJiYgYW55IGluc3RhbmNlb2YgalF1ZXJ5KSl7XHJcbiAgICAgICAgICAgIHJldHVybiBbIC4uLihhbnkgYXMgTm9kZUxpc3QpXVxyXG4gICAgICAgIH1lbHNlIGlmKEFycmF5LmlzQXJyYXkoYW55KSl7XHJcbiAgICAgICAgICAgIHJldHVybiBhbnlcclxuICAgICAgICAgICAgLmZpbHRlcihlPT4gKHR5cGVvZiBlID09PSAnc3RyaW5nJykgfHwgZSBpbnN0YW5jZW9mIE5vZGUgKVxyXG4gICAgICAgICAgICAubWFwKGU9PiAodHlwZW9mIGUgPT09ICdzdHJpbmcnKSA/IERvY09iamVjdC50b05vZGVBcnJheShlKVswXSA6IGUgKTtcclxuICAgICAgICB9IGVsc2UgaWYoYW55IGluc3RhbmNlb2YgTm9kZSB8fCBhbnkgaW5zdGFuY2VvZiBEb2N1bWVudCApe1xyXG4gICAgICAgICAgICByZXR1cm4gW2FueV1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGRlZmF1bHRQYXJhbXMoe1xyXG4gICAgICAgIHJlbmRlciA9IFtdLFxyXG4gICAgICAgIGJpbmRzID0ge30sXHJcbiAgICAgICAgZWxlbWVudHMgPSB7fSxcclxuICAgICAgICB2YWx1ZXMgPSB7fSxcclxuICAgICAgICBiaW5kQXR0ciA9ICdkLWJpbmQnLFxyXG4gICAgICAgIGJpbmRJbkF0dHIgPSAnZC1iaW5kLWluJyxcclxuICAgICAgICBpc0pRdWVyeSA9IGZhbHNlXHJcbiAgICB9ID0ge30pIDogRG9jT2JqZWN0T3B0aW9ucyB7XHJcbiAgICAgICAgcmV0dXJuICB7IGVsZW1lbnRzLCB2YWx1ZXMsIHJlbmRlciwgYmluZHMsIGJpbmRBdHRyLCBiaW5kSW5BdHRyLCBpc0pRdWVyeSB9IFxyXG4gICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgIF92YWx1ZXMgOiBvYmplY3Q7XHJcbiAgICBlbGVtZW50cyA6IFByb3h5SGFuZGxlcjxEb2NPYmplY3RFbGVtZW50cz47XHJcbiAgICByb290IDogRG9jT2JqZWN0RWxlbWVudDtcclxuICAgIHJlbmRlciA6IERvY09iamVjdFJlbmRlcjtcclxuICAgIGJpbmRzIDogRG9jT2JqZWN0QmluZDtcclxuICAgIGJpbmRBdHRyIDogc3RyaW5nO1xyXG4gICAgYmluZEluQXR0ciA6IHN0cmluZztcclxuICAgIHF1ZXJ5IDogUHJveHlIYW5kbGVyPERvY09iamVjdEVsZW1lbnRzPjtcclxuICAgIF9xdWVyeVNlbGVjdCA6IChzZWxlY3RvcjpzdHJpbmcpPT4gTm9kZUxpc3QgfCBKUXVlcnk7XHJcbiAgICBfaXNKUXVlcnkgOiBib29sZWFuXHJcbiAgICBvbkxvYWQ6ICgpPT52b2lkXHJcblxyXG4gICAgc2V0IHZhbHVlcyh2YWx1ZXMpIHtcclxuICAgICAgICB0aHJvdyBFcnJvcihcIlRyaWVkIHRvIHNldCBEb2NPYmplY3QudmFsdWUuIFRyeSBjcmVhdGluZyBhIGlubmVyIG9iamVjdCBpbnN0ZWFkLlwiKVxyXG4gICAgfVxyXG4gICAgZ2V0IHZhbHVlcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWVzO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIGNvbnN0cnVjdG9yKHJvb3QgOiBEb2NPYmplY3RFbGVtZW50IHwgSlF1ZXJ5LCBvcHRpb25zIDogb2JqZWN0KSB7XHJcbiAgICAgICAgLy9BZGQgRGVmYXVsdCBQYXJhbWV0ZXJzIHRvIG9wdGlvbnNcclxuICAgICAgICBjb25zdCB7IGVsZW1lbnRzLCB2YWx1ZXMsIHJlbmRlciwgYmluZHMsIGJpbmRBdHRyLCBiaW5kSW5BdHRyLCBpc0pRdWVyeSB9IDogRG9jT2JqZWN0T3B0aW9ucyA9IERvY09iamVjdC5kZWZhdWx0UGFyYW1zKG9wdGlvbnMpXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy9FeHRyYWN0IERPTSBlbGVtZW50IGZyb20gSFRNTEVsZW1lbnQgT3IgSnF1ZXJ5IE9iamVjdFxyXG4gICAgICAgIGxldCByb290RWxlbWVudCA9IERvY09iamVjdC50b05vZGVBcnJheShyb290KVswXVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vU2V0IFJvb3QgT2JqZWN0XHJcbiAgICAgICAgaWYocm9vdEVsZW1lbnQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCApe1xyXG4gICAgICAgICAgICB0aGlzLnJvb3QgPSByb290RWxlbWVudFxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBydW5FcnJvcihST09UX0VSUk9SLCB0cnVlKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9TZXQgSnF1ZXJ5XHJcbiAgICAgICAgaWYoaXNKUXVlcnkgJiYgd2luZG93LmpRdWVyeSl7XHJcbiAgICAgICAgICAgIC8vSWYgSnF1ZXJ5IGlzIGRldGVjdGVkIGFuZCBpcyBzZXQgdG8ganF1ZXJ5IG1vZGUuLi5cclxuICAgICAgICAgICAgdGhpcy5faXNKUXVlcnkgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgLy9TZXQgUXVlcnkgU2VsZWN0IHN0YXRlbWVudCB0byB1c2UgalF1ZXJ5XHJcbiAgICAgICAgICAgIHRoaXMuX3F1ZXJ5U2VsZWN0ID0gKC4uLnByb3BzKSA9PiAkKHRoaXMucm9vdCkuZmluZCguLi5wcm9wcylcclxuICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgIC8vSWYgSnF1ZXJ5IGlzIG5vdCBkZXRlY3RlZC4uLlxyXG4gICAgICAgICAgICBpZihpc0pRdWVyeSl7XHJcbiAgICAgICAgICAgICAgICAvL0lmIHNldCB0byBqcXVlcnkgbW9kZS4uLlxyXG4gICAgICAgICAgICAgICAgcnVuRXJyb3IoSlFVRVJZX05PVF9ERVRFQ1RFRCwgZmFsc2UpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9TZXQgUXVlcnkgU2VsZWN0IHN0YXRlbWVudCB0byB1c2UgSFRNTEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbFxyXG4gICAgICAgICAgICB0aGlzLl9pc0pRdWVyeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLl9xdWVyeVNlbGVjdCA9ICguLi5wcm9wcykgPT4gdGhpcy5yb290LnF1ZXJ5U2VsZWN0b3JBbGwoLi4ucHJvcHMpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL1NldCBSb290IE9iamVjdCB0byB0aGlzXHJcbiAgICAgICAgdGhpcy5yb290Ll9Eb2NPYmplY3QgPSB0aGlzO1xyXG5cclxuICAgICAgICAvL1NldCBSZW5kZXIgRnVuY3Rpb25zXHJcbiAgICAgICAgdGhpcy5yZW5kZXIgPSByZW5kZXI7XHJcblxyXG4gICAgICAgIC8vU2V0IEJpbmQgRnVuY3Rpb25zXHJcbiAgICAgICAgdGhpcy5iaW5kcyA9IGJpbmRzO1xyXG5cclxuICAgICAgICAvL1NldCBCaW5kIEF0dHJpYnV0ZVxyXG4gICAgICAgIHRoaXMuYmluZEF0dHIgPSBiaW5kQXR0cjtcclxuXHJcbiAgICAgICAgLy9TZXQgQmluZCBJbiBBdHRyaWJ1dGVcclxuICAgICAgICB0aGlzLmJpbmRJbkF0dHIgPSBiaW5kSW5BdHRyO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vU2V0IFF1ZXJ5IFByb3h5XHJcbiAgICAgICAgdGhpcy5xdWVyeSA9IG5ldyBQcm94eSh7fSwge1xyXG4gICAgICAgICAgICBnZXQ6ICh0YXJnZXQsIHByb3AgKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZih0eXBlb2YgcHJvcCA9PSAnc3RyaW5nJylcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIHRhcmdldFtwcm9wXSA/IHRhcmdldFtwcm9wXSA6IF8gPT4gdGhpcy5fcXVlcnlTZWxlY3QoIC8uKihcXC58XFwjfFxcW3xcXF0pLiovZ20uZXhlYyhwcm9wKSA/IHByb3AgOiAnIycgKyBwcm9wICkgXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNldDogKHRhcmdldCwgcHJvcCwgdmFsdWUsIHJlY2VpdmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgdmFsdWUgPSAoKSA9PiB0aGlzLl9xdWVyeVNlbGVjdCh2YWx1ZSlcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcHJvcCA9PT0gJ3N0cmluZycpe1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFtwcm9wXSA9IF8gPT4gdmFsdWVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vU2V0IEVsZW1lbnRzIFByb3h5XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cyA9IG5ldyBQcm94eSh0aGlzLnF1ZXJ5LCB7XHJcbiAgICAgICAgICAgIGdldDogKHRhcmdldCwgcHJvcCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldFtwcm9wXSgpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICAvL0FkZCBpbiBlbGVtZW50cyBmcm9tIG9wdGlvbnNcclxuICAgICAgICBpZiAoZWxlbWVudHMpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoZWxlbWVudHMpLmZvckVhY2goKGUgPT4geyB0aGlzLnF1ZXJ5W2VbMF1dID0gZVsxXSB9KSlcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB0aGlzLl92YWx1ZXMgPSBuZXcgUHJveHkoIXZhbHVlcyB8fCB0eXBlb2YgdmFsdWVzICE9PSAnb2JqZWN0JyA/IHt9IDogdmFsdWVzLCB7XHJcbiAgICAgICAgICAgIHNldDogKHRhcmdldCwgcHJvcCwgdmFsdWUsIHJlY2VpdmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJ1blJlbmRlcih7IFtwcm9wXTogdmFsdWUgfSlcclxuICAgICAgICAgICAgICAgIHRhcmdldFtwcm9wXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIFxyXG4gICAgICAgIHRoaXMub25Mb2FkID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnJ1blJlbmRlcih7IFt0cnVlIGFzIGFueV06IHRydWUgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodGhpcy5faXNKUXVlcnkpe1xyXG4gICAgICAgICAgICAkKHRoaXMub25Mb2FkKVxyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB3aW5kb3cub25sb2FkID0gdGhpcy5vbkxvYWRcclxuICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIGlzQmluZEluKGVsZW1lbnQgOiBEb2NPYmplY3REb21CaW5kKSA6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAoIGVsZW1lbnQuZ2V0QXR0cmlidXRlKHRoaXMuYmluZEluQXR0cikgJiYgdHJ1ZSApIFxyXG4gICAgfVxyXG4gICAgaXNCaW5kKGVsZW1lbnQgOiBEb2NPYmplY3REb21CaW5kKSA6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiAoZWxlbWVudC5sb2NhbE5hbWUgPT09ICdkLWJpbmQnIHx8IGVsZW1lbnQuZ2V0QXR0cmlidXRlKHRoaXMuYmluZEF0dHIpKSAmJiB0cnVlXHJcbiAgICB9XHJcbiAgICBmaW5kT3JSZWdpc3RlckJpbmQoRE9NZWxlbWVudCA6IERvY09iamVjdERvbUJpbmQpIDogRG9jT2JqZWN0Q29uZmlnIHtcclxuICAgICAgICBpZihET01lbGVtZW50Ll9Eb2NPYmplY3RDb25maWcgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgICAgIGxldCBvcmlnaW5hbENoaWxkcmVuID0gWy4uLkRPTWVsZW1lbnQuY2hpbGROb2Rlc11cclxuICAgICAgICAgICAgb3JpZ2luYWxDaGlsZHJlbi50b1N0cmluZyA9ICgpPT4gRE9NZWxlbWVudC5pbm5lckhUTUxcclxuICAgICAgICAgICAgRE9NZWxlbWVudC5fRG9jT2JqZWN0Q29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luYWxDaGlsZHJlbixcclxuICAgICAgICAgICAgICAgIG9yaWdpbmFsQ2hpbGRyZW5IVE1MOiBET01lbGVtZW50LmlubmVySFRNTCxcclxuICAgICAgICAgICAgICAgIG9yaWdpbmFsQXR0cmlidXRlczogWy4uLkRPTWVsZW1lbnQuYXR0cmlidXRlc10ucmVkdWNlKCAoYSxjKT0+e3JldHVybiB7Li4uYSwgW2MubmFtZV06Yy52YWx1ZX0gfSwge30gKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBET01lbGVtZW50Ll9Eb2NPYmplY3RDb25maWdcclxuICAgIH1cclxuXHJcbiAgICBnZW5lcmF0ZUJpbmQoZWxlbWVudCA6IERvY09iamVjdERvbUJpbmQsIGJpbmQsIGJvdW5kIDogRG9jT2JqZWN0SFRNTExpa2UgKSA6IERvY09iamVjdERvbUJpbmQgfCBOb2RlW10ge1xyXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGVsZW1lbnQuX0RvY09iamVjdENvbmZpZztcclxuICAgICAgICBjb25zdCBub2RlQXJyYXkgPSBEb2NPYmplY3QudG9Ob2RlQXJyYXkoYm91bmQpO1xyXG4gICAgICAgIGlmKHRoaXMuaXNCaW5kKGVsZW1lbnQpKXtcclxuICAgICAgICAgICAgY29uc3QgZmlyc3RFbGVtZW50ID0gbm9kZUFycmF5LmZpbmQoZWwgPT4gZWwgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkgYXMgRG9jT2JqZWN0RG9tQmluZDtcclxuICAgICAgICAgICAgZmlyc3RFbGVtZW50Ll9Eb2NPYmplY3RDb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgICAgIGZpcnN0RWxlbWVudC5zZXRBdHRyaWJ1dGUoKGZpcnN0RWxlbWVudC5sb2NhbE5hbWUgPT09ICdkLWJpbmQnID8gJ3RvJyA6IHRoaXMuYmluZEF0dHIpLCBiaW5kKVxyXG4gICAgICAgICAgICBPYmplY3QuZW50cmllcyhjb25maWcub3JpZ2luYWxBdHRyaWJ1dGVzKS5maWx0ZXIoYXR0QT0+IShbJ2QtYmluZC1pbicsICd0byddLmluY2x1ZGVzKGF0dEFbMF0pKSkuZm9yRWFjaChhdHRBPT5maXJzdEVsZW1lbnQuc2V0QXR0cmlidXRlKGF0dEFbMF0sIGF0dEFbMV0pKVxyXG4gICAgICAgICAgICByZXR1cm4gZmlyc3RFbGVtZW50O1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICByZXR1cm4gbm9kZUFycmF5O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBcclxuXHJcbiAgICBydW5SZW5kZXIodmFsdWVDaGFuZ2VzID0ge30pIDogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yZW5kZXIuZmlsdGVyKHJlbiA9PiAocmVuLmRlcCAmJiBBcnJheS5pc0FycmF5KHJlbi5kZXApICYmIHJlbi5kZXAuc29tZSgoZGVwcCkgPT4gKGRlcHAgaW4gdmFsdWVDaGFuZ2VzKSkpIHx8IChyZW4uZGVwID09PSB1bmRlZmluZWQpKS5mb3JFYWNoKHJlbiA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZW4uY2xlYW4pIHJlbi5jbGVhbih7IC4uLnRoaXMudmFsdWVzLCAuLi52YWx1ZUNoYW5nZXMgfSwgdGhpcy52YWx1ZXMpXHJcbiAgICAgICAgICAgIHJlbi5hY3Rpb24oeyAuLi50aGlzLnZhbHVlcywgLi4udmFsdWVDaGFuZ2VzIH0sIHRoaXMudmFsdWVzKVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdGhpcy5ydW5CaW5kcyh0aGlzLnJvb3QsIHZhbHVlQ2hhbmdlcyk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0QmluZEFjdGlvbihlbGVtZW50IDogSFRNTEVsZW1lbnQpIDogW3N0cmluZywgKHJlcGxhY2UgOiBOb2RlICYgTm9kZUxpc3QgKT0+dm9pZF0ge1xyXG4gICAgICAgIGlmKHRoaXMuaXNCaW5kKGVsZW1lbnQpKXtcclxuICAgICAgICAgICAgaWYoZWxlbWVudC5nZXRBdHRyaWJ1dGUodGhpcy5iaW5kQXR0cikpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtlbGVtZW50LmdldEF0dHJpYnV0ZSh0aGlzLmJpbmRBdHRyKSwgKHJlcGxhY2UpPT5lbGVtZW50LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHJlcGxhY2UsIGVsZW1lbnQpXVxyXG4gICAgICAgICAgICB9ZWxzZSBpZihlbGVtZW50LmxvY2FsTmFtZSA9PT0gJ2QtYmluZCcpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtlbGVtZW50LmdldEF0dHJpYnV0ZSgndG8nKSwgKHJlcGxhY2UpPT5lbGVtZW50LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHJlcGxhY2UsIGVsZW1lbnQpXVxyXG4gICAgICAgICAgICB9IFxyXG4gICAgICAgIH1lbHNlIGlmKHRoaXMuaXNCaW5kSW4oZWxlbWVudCkpe1xyXG4gICAgICAgICAgICByZXR1cm4gW2VsZW1lbnQuZ2V0QXR0cmlidXRlKHRoaXMuYmluZEluQXR0ciksIChyZXBsYWNlKT0+e1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSAnJztcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IG5vZGUgb2YgcmVwbGFjZSkgZWxlbWVudC5hcHBlbmRDaGlsZChub2RlKTtcclxuICAgICAgICAgICAgfV1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHJ1bkJpbmRzKHJvb3QsIHZhbHVlQ2hhbmdlcyA9IHt9KSB7XHJcbiAgICAgICAgKEFycmF5LmlzQXJyYXkocm9vdCkgPyByb290IDogW3Jvb3RdKSBcclxuICAgICAgICAuZmlsdGVyKHJ0PT5ydCAmJiBydCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KVxyXG4gICAgICAgIC5mb3JFYWNoKChydCk9PntcclxuICAgICAgICAgICAgWyAuLi4ocnQucXVlcnlTZWxlY3RvckFsbChgWyR7dGhpcy5iaW5kQXR0cn1dLCBbJHt0aGlzLmJpbmRJbkF0dHJ9XSwgZC1iaW5kW3RvXWApKSBdIFxyXG4gICAgICAgICAgICAuZm9yRWFjaCggZWxlbWVudCA9PiB7XHJcbiAgICAgICAgICAgICAgICAvL0dldCBUaGUgQmluZCBNZXRob2QsIGFuZCB0aGUgRnVuY3Rpb24gdG8gaW5zZXJ0IEhUTUwgXHJcbiAgICAgICAgICAgICAgICBjb25zdCBbYmluZCwgYmluZEFjdGlvbl0gPSB0aGlzLmdldEJpbmRBY3Rpb24oZWxlbWVudClcclxuICAgICAgICAgICAgICAgIC8vQ2hlY2sgaWYgQmluZCBFeGlzdHMgXHJcbiAgICAgICAgICAgICAgICBpZiAoYmluZCBpbiB0aGlzLmJpbmRzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vR2V0IE9yIHJlZ2lzdGVyIEJpbmQgVGFnJ3MgQ29uZmlnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuZmluZE9yUmVnaXN0ZXJCaW5kKGVsZW1lbnQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0luc2VydCBIVE1MXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRBY3Rpb24odGhpcy5ydW5CaW5kcyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9XcmFwIEJpbmQgTWV0aG9kIHRvIHByZXBhcmUgYmluZCBmb3IgZG9jdW1lbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVCaW5kKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJpbmQsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vUnVuIEJpbmQgTWV0aG9kXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5iaW5kc1tiaW5kXShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAuLi50aGlzLnZhbHVlcywgLi4udmFsdWVDaGFuZ2VzIH0sIC8vUGFzcyBpbiB1cGRhdGVzIHZhbHVlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcub3JpZ2luYWxBdHRyaWJ1dGVzLCAvL1Bhc3MgaW4gb3JpZ2luYWwgYXR0cmlidXRlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcub3JpZ2luYWxDaGlsZHJlbiwgLy9QYXNzIGluIG9yaWdpbmFsIGNoaWxkcmVuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlQ2hhbmdlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIHJvb3Q7XHJcbiAgICB9XHJcbn1cclxuaWYod2luZG93LmpRdWVyeSl7XHJcbiAgICAoZnVuY3Rpb24oJCkge1xyXG4gICAgICAgICQuZm4uZXh0ZW5kKHtcclxuICAgICAgICAgICAgRG9jT2JqZWN0IDogZnVuY3Rpb24oIG9wdGlvbnMgPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzWzBdLl9Eb2NPYmplY3QgJiYgIW9wdGlvbnMgKSByZXR1cm4gdGhpc1swXS5fRG9jT2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5ldyBEb2NPYmplY3QodGhpcywgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIG5ldyBEb2NPYmplY3QodGhpcywgeyBpc0pRdWVyeTp0cnVlLCAuLi5vcHRpb25zIH0pXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1swXS5fRG9jT2JqZWN0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0pKGpRdWVyeSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBvYmoocm9vdCA6IERvY09iamVjdEVsZW1lbnQgfCBKUXVlcnksIG9wdGlvbnMgOiBvYmplY3QpIDogRG9jT2JqZWN0e1xyXG4gICAgcmV0dXJuIG5ldyBEb2NPYmplY3Qocm9vdCwgb3B0aW9ucylcclxufVxyXG5cclxuXHJcbi8qXHJcbnZhciBkb2MgPSBuZXcgRG9jT2JqZWN0KHtcclxuICAgIHZhbHVlczoge1xyXG4gICAgfSxcclxuICAgIGVsZW1lbnRzOntcclxuXHJcbiAgICB9LFxyXG4gICAgYmluZHM6e1xyXG5cclxuICAgIH0sXHJcbiAgICByZW5kZXI6IFtcclxuXHJcbiAgICBdXHJcbn0pOyAkKGRvYy5vbkxvYWQpXHJcbiovIiwiXHJcblxyXG5leHBvcnQgY29uc3QgUk9PVF9FUlJPUiA9ICdST09UX0VSUk9SJ1xyXG5leHBvcnQgY29uc3QgSlFVRVJZX05PVF9ERVRFQ1RFRCA9ICdKUVVFUllfTk9UX0RFVEVDVEVEJ1xyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJ1bkVycm9yKGVycm9yIDogc3RyaW5nLCBmYWlsPWZhbHNlKXtcclxuICAgIGlmKGVycm9yIGluIEVSUk9SUyl7XHJcbiAgICAgICAgaWYoZmFpbCl7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdEb2NPYmplY3Q6ICcrIEVSUk9SU1tlcnJvcl0ubWVzc2FnZSk7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoRVJST1JTW2Vycm9yXS5tZXNzYWdlKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuY29uc3QgRVJST1JTID0ge1xyXG4gICAgUk9PVF9FUlJPUiA6IHtcclxuICAgICAgICBtZXNzYWdlOiBcIlJvb3QgRWxlbWVudCBNdXN0IGJlIGEgdmFsaWQgTm9kZSwgT3IgalF1ZXJ5IEVsZW1lbnRcIlxyXG4gICAgfSxcclxuICAgIEpRVUVSWV9OT1RfREVURUNURUQ6IHtcclxuICAgICAgICBtZXNzYWdlIDogXCJKUXVlcnkgaXMgbm90IGRldGVjdGVkLiBQbGVhc2UgbG9hZCBKUXVlcnkgYmVmb3JlIERvY09iamVjdFwiXHJcbiAgICB9XHJcbn1cclxuIiwiaW50ZXJmYWNlIERvY3VtZW50IHtcclxuICAgIHNlbGVjdGlvbjoge1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG59XHJcblxyXG4vLyBDcmVkaXRzOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yODk3MTU1L2dldC1jdXJzb3ItcG9zaXRpb24taW4tY2hhcmFjdGVycy13aXRoaW4tYS10ZXh0LWlucHV0LWZpZWxkXHJcbiBleHBvcnQgZnVuY3Rpb24gZ2V0Q3Vyc29yUG9zKGVsZW1lbnQgOiBIVE1MSW5wdXRFbGVtZW50KSA6IG51bWJlciB7XHJcbiAgICAvLyBpZiAoZG9jdW1lbnQuc2VsZWN0aW9uKSB7XHJcbiAgICAvLyAgICAgZWxlbWVudC5mb2N1cygpO1xyXG4gICAgLy8gICAgIHJldHVybiAgZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkubW92ZVN0YXJ0KCdjaGFyYWN0ZXInLCAtZWxlbWVudC52YWx1ZS5sZW5ndGgpO1xyXG4gICAgLy8gfVxyXG4gICAgICAgIHJldHVybiBlbGVtZW50LnNlbGVjdGlvbkRpcmVjdGlvbiA9PSAnYmFja3dhcmQnID8gZWxlbWVudC5zZWxlY3Rpb25TdGFydCA6IGVsZW1lbnQuc2VsZWN0aW9uRW5kO1xyXG59XHJcblxyXG4vLyBDcmVkaXRzOiBodHRwOi8vYmxvZy52aXNoYWxvbi5uZXQvaW5kZXgucGhwL2phdmFzY3JpcHQtZ2V0dGluZy1hbmQtc2V0dGluZy1jYXJldC1wb3NpdGlvbi1pbi10ZXh0YXJlYS9cclxuZXhwb3J0IGZ1bmN0aW9uIHNldEN1cnNvclBvcyhlbGVtZW50IDogSFRNTElucHV0RWxlbWVudCwgcG9zIDogbnVtYmVyKSA6IHZvaWQge1xyXG4gICAgLy8gTW9kZXJuIGJyb3dzZXJzXHJcbiAgICBpZiAoZWxlbWVudC5zZXRTZWxlY3Rpb25SYW5nZSkge1xyXG4gICAgZWxlbWVudC5mb2N1cygpO1xyXG4gICAgZWxlbWVudC5zZXRTZWxlY3Rpb25SYW5nZShwb3MsIHBvcyk7XHJcbiAgICBcclxuICAgIC8vIElFOCBhbmQgYmVsb3dcclxuICAgIH0gZWxzZSBpZiAoKGVsZW1lbnQgYXMgYW55KS5jcmVhdGVUZXh0UmFuZ2UpIHtcclxuICAgICAgdmFyIHJhbmdlID0gKGVsZW1lbnQgYXMgYW55KS5jcmVhdGVUZXh0UmFuZ2UoKTtcclxuICAgICAgcmFuZ2UuY29sbGFwc2UodHJ1ZSk7XHJcbiAgICAgIHJhbmdlLm1vdmVFbmQoJ2NoYXJhY3RlcicsIHBvcyk7XHJcbiAgICAgIHJhbmdlLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgcG9zKTtcclxuICAgICAgcmFuZ2Uuc2VsZWN0KCk7XHJcbiAgICB9XHJcbn0iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM5MSk7XG4iXSwibmFtZXMiOlsic2VsZWN0b3IiLCJhY3Rpb24iLCJwb3MiLCJnZXRDdXJzb3JQb3MiLCJzZXRDdXJzb3JQb3MiLCJCaW5kIiwiSFRNTEVsZW1lbnQiLCJjb25zdHJ1Y3RvciIsInN1cGVyIiwid2luZG93IiwiY3VzdG9tRWxlbWVudHMiLCJkZWZpbmUiLCJEb2NPYmplY3QiLCJyb290Iiwib3B0aW9ucyIsImVsZW1lbnRzIiwidmFsdWVzIiwicmVuZGVyIiwiYmluZHMiLCJiaW5kQXR0ciIsImJpbmRJbkF0dHIiLCJpc0pRdWVyeSIsImRlZmF1bHRQYXJhbXMiLCJyb290RWxlbWVudCIsInRvTm9kZUFycmF5IiwidGhpcyIsIlJPT1RfRVJST1IiLCJqUXVlcnkiLCJfaXNKUXVlcnkiLCJfcXVlcnlTZWxlY3QiLCJwcm9wcyIsIiQiLCJmaW5kIiwiSlFVRVJZX05PVF9ERVRFQ1RFRCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfRG9jT2JqZWN0IiwicXVlcnkiLCJQcm94eSIsImdldCIsInRhcmdldCIsInByb3AiLCJfIiwiZXhlYyIsInNldCIsInZhbHVlIiwicmVjZWl2ZXIiLCJPYmplY3QiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImUiLCJfdmFsdWVzIiwicnVuUmVuZGVyIiwib25Mb2FkIiwib25sb2FkIiwic3RhdGljIiwiYW55IiwicGFyc2VyIiwicGFyc2VGcm9tU3RyaW5nIiwiYm9keSIsImNoaWxkTm9kZXMiLCJOb2RlTGlzdCIsInByb3RvdHlwZSIsImlzUHJvdG90eXBlT2YiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJOb2RlIiwibWFwIiwiRG9jdW1lbnQiLCJFcnJvciIsImlzQmluZEluIiwiZWxlbWVudCIsImdldEF0dHJpYnV0ZSIsImlzQmluZCIsImxvY2FsTmFtZSIsImZpbmRPclJlZ2lzdGVyQmluZCIsIkRPTWVsZW1lbnQiLCJ1bmRlZmluZWQiLCJfRG9jT2JqZWN0Q29uZmlnIiwib3JpZ2luYWxDaGlsZHJlbiIsInRvU3RyaW5nIiwiaW5uZXJIVE1MIiwib3JpZ2luYWxDaGlsZHJlbkhUTUwiLCJvcmlnaW5hbEF0dHJpYnV0ZXMiLCJhdHRyaWJ1dGVzIiwicmVkdWNlIiwiYSIsImMiLCJuYW1lIiwiZ2VuZXJhdGVCaW5kIiwiYmluZCIsImJvdW5kIiwiY29uZmlnIiwibm9kZUFycmF5IiwiZmlyc3RFbGVtZW50IiwiZWwiLCJzZXRBdHRyaWJ1dGUiLCJhdHRBIiwiaW5jbHVkZXMiLCJ2YWx1ZUNoYW5nZXMiLCJyZW4iLCJkZXAiLCJzb21lIiwiZGVwcCIsImNsZWFuIiwicnVuQmluZHMiLCJnZXRCaW5kQWN0aW9uIiwicmVwbGFjZSIsInBhcmVudE5vZGUiLCJyZXBsYWNlQ2hpbGQiLCJub2RlIiwiYXBwZW5kQ2hpbGQiLCJydCIsImJpbmRBY3Rpb24iLCJET01QYXJzZXIiLCJmbiIsImV4dGVuZCIsImVhY2giLCJlcnJvciIsImZhaWwiLCJFUlJPUlMiLCJtZXNzYWdlIiwiY29uc29sZSIsInNlbGVjdGlvbkRpcmVjdGlvbiIsInNlbGVjdGlvblN0YXJ0Iiwic2VsZWN0aW9uRW5kIiwic2V0U2VsZWN0aW9uUmFuZ2UiLCJmb2N1cyIsImNyZWF0ZVRleHRSYW5nZSIsInJhbmdlIiwiY29sbGFwc2UiLCJtb3ZlRW5kIiwibW92ZVN0YXJ0Iiwic2VsZWN0IiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX2V4cG9ydHNfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=